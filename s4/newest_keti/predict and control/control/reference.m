clear all
clc
W1_L=[    1.5954    0.0944   -1.5150   -0.1822   -0.2041   -0.2570    0.1059    0.0178    0.8328
   -7.0414    4.2851    1.4973    0.1346    0.4027   -0.0782   -0.2167    0.1027   -0.8742
   -1.1116   -1.0986    1.2383   -0.2217   -0.8396   -0.0283    0.7044    0.3585   -0.8222
    5.1273   -9.2403   -0.5062   -0.1124   -0.3977    0.8291   -0.3197    0.1805    3.7742
   -0.0325    0.7693    1.3264   -0.0221   -0.4059    2.2513    0.1124    0.4665   -1.6235
   -7.3135    2.8828
   
   2.4495   -0.1035   -0.3550   -0.1950    0.3573    0.4548   -0.5450
   -8.1083    1.6334    2.6954   -0.3256   -0.6375   -0.3527    0.5599    0.4324    0.2662
   -2.7338    0.6543    1.3998    0.1942    0.3708    0.2207   -0.1895   -0.0090   -0.6714
    5.9048   -3.9353   -0.9701   -0.2046   -0.7535    0.0130    0.4476    0.1167    0.9359
   -5.7546    9.8329    0.9548    0.0716    0.3811   -0.8847    0.4104   -0.1628   -4.0724
   -7.8912    0.8702    2.5471   -0.3660   -0.6847   -0.3864    0.5937    0.4166    0.5537
   -1.2971    2.8783   -0.5947    0.2116    0.6423   -0.3713   -0.6075    0.0098    0.4846
   -1.5604    2.4519   -0.3160    0.0413    0.3363   -0.4759   -0.2980    0.0954    0.6542
    0.1234    0.8440    0.9548   -0.0123   -0.3234    1.8326    0.1397    0.3812   -1.3665];
W2_L=[   -3.9306   -3.5866   -2.4866    1.8453   -0.8408    3.9770   -5.7190   -4.5743   -3.2409    1.6313    3.9404   -2.2192    2.5437    1.1424   -0.9453];
C=xlsread('D:\研究生\研二\项目资料\程序\贾广政论文和程序\控制算法\jiaNNPOC _logsig版\预测模型输入数据.xlsx');  
C=C';
C
%param=sturct('P',{6},'maxEpoch',{5000},'ep',{1.0e-12},'alpha',{3},'gamma',{0.2},'lr',{0.02});
    %% 参数
    param.P=6;                  %步长
    param.maxEpoch=2000;    %最大迭代步数
    param.ep=1.0e-12;                %目标精度
    param.alpha=3;          %状态权重系数
    param.gamma=0.5;          %动量因子
    param.lr=0.02;                %学习率
x(:,1)=[0.60];      %选取上午八点EER点归一化后数据
%xset=0.2; %EER设置为最大
v(:,1)=[0.78;0.85;0.60];%早上八点，温度、湿度、负荷
W1_M=[   -4.3323   -3.6770   -5.2739   -0.8908   -0.5773    1.8867    9.3655
    6.3162    4.2553   -1.8273    3.9731    0.7244   -5.3555   -7.1396
   -1.1695   -1.6103   -0.6274   -3.2010    1.1285   -0.0397    4.4009
   -2.6683    3.4160   -1.1248    2.2530   -0.6723    0.8261   -0.0455
   -0.8009   -4.0442   -6.9656    4.9205    4.0392    7.0692   -3.5411
    1.1512    1.5863   -0.5909    0.9105    0.1157    0.1705   -1.5022
   -0.0821    3.0730    1.6376    0.5387    0.8061   -1.7848   -2.9258
   -1.4236   -2.9263    8.2605   -0.4007    0.6205   10.2903   -6.9911
    9.4867    6.1503   -3.7178   -0.0658    0.7911  -10.4903   -1.2877
   -6.0556    0.2799   -2.9103    3.3298   -1.6366    4.4817    2.1638]    
W2_M=[   -0.3008    0.1790    0.2535   -0.2332   -0.0717    0.5046   -0.4413    0.0727    0.0825    0.1522    0.4333]    
%W1_C=rands(6,6);
%W2_C=rands(2,7);
W1_C=[   -0.1713   -0.7928   -0.7441    0.6702    0.4217   -0.0721
   -0.3583   -0.9400    0.6948   -1.0356    0.3368    0.7772
   -0.3975   -0.0851   -0.5587   -0.7635   -0.3334    0.0247
   -0.1749    0.8030    0.4107    0.7672   -0.5794    0.4792
   -0.1409    0.9305    1.0215   -0.0441   -0.6235   -0.1909
    0.0980   -0.4861    0.2173    0.6580   -0.7015    0.0590];
W2_C=[   -0.1756    0.6315   -0.5735    0.4807    1.1129   -0.2408    0.0699
   -0.0241   -1.0895   -1.0204    0.1787    0.1201   -0.4254    0.3312];
xs(1:60,1)=0;
t(1,1:60)=0;
w(1,1:60)=0;
q(1,1:60)=0;
for n=1:60
    n
    t(1,n)=(C(3,n)-13.02)/(34.63-13.02);%温度按系统模型最值归一化
    w(1,n)=(C(4,n)-27.07)/(99.28-27.07);%湿度按系统模型最值归一化
    if(n>6)
        C(1,n)=q(1,(n-6));
    end
    q(1,n)= LOAD_FORECAST(C(1:8,n),W1_L,W2_L);%负荷预测值
    q(1,n)=q(1,n)/2.5;    
    q_std=((q(1,n)-101.54)/(434.75-101.54));%负荷按系统模型最值归一化
    v(:,1)=[t(1,n);w(1,n);q_std];
%    end
    if(n<=20)
        xset=0.60;%EER的设定值
    else if((n>20)&(n<=40))
            xset=0.68;%EER的设定值
        else
            v(:,1)=[t(1,n);w(1,n);1];
        end
        
    end
%        v(:,1)=[0.78;0.85;0.65];
%        xset=0.69;
%        v(:,1)=[0.78;0.85;0.9];
%     else if((n>20)&(n<=40))
%             xset=0.68;%EER的设定值           
%         else
%             v(:,1)=[t(1,n);w(1,n);0.92];
%         end
%   end
    
    
    [u,xpre,W1,W2]= NNOptimizer(x,xset,v,param,W1_M,W2_M,W1_C,W2_C);    
    u1(n,:)=u;
    x1(n,:)=xpre;%记录状态变化值
    x=xpre(1,2);
    W1_C=W1;
    W2_C=W2;
    xs(n,1)=xset;
end
W1_C
W2_C
figure
plot(u1(:,1)*6.1+4.5);
%plot(u1(:,1));
title('冷冻水出水温度');
xlabel('时间/5分钟');
ylabel('控制信号(V)');
hold on

figure
plot(u1(:,2)*38.6+9.3);
%plot(u1(:,2));
title('冷冻泵频率');
xlabel('时间/5分钟');
ylabel('控制信号(V)');
hold on

figure
plot(x1(:,2)*4);
xlabel('时间/5分钟');
ylabel('EER');
hold on
plot(xs(1:60,1)*4,'r');
hold off

figure
plot(q(1,1:60));
%plot(u1(:,2));
title('负荷预测值');
xlabel('时间/5分钟');
ylabel('KW');
hold on

